<!-- src\app\dashboard\sidebar\sidebar.component.html -->

<aside
  class="bg-gray-800 text-white h-screen overflow-y-auto transition-all duration-300 flex flex-col scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-gray-800"
  [ngClass]="{
  'w-64': isSidebarExpanded && !isMobile,
  'w-20': !isSidebarExpanded && !isMobile,
  'w-full': isMobile
}">
  <div class="flex items-center py-6 px-4 border-b border-gray-700" [ngClass]="{
      'justify-start': isSidebarExpanded,
      'justify-center': !isSidebarExpanded
    }">
    <button (click)="!isMobile && toggleSidebar()" (keyup.enter)="!isMobile && toggleSidebar()" [disabled]="isMobile"
      class="text-gray-300 hover:text-white transition-colors duration-300 flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-blue-300 rounded"
      [attr.aria-label]="isSidebarExpanded ? 'Collapse sidebar' : 'Expand sidebar'" [ngClass]="{
        'text-2xl': !isMobile,
        'text-2xl cursor-default': isMobile
      }">
      <i class="fas fa-bars"></i>
    </button>
    @if (isSidebarExpanded && !isMobile) {
    <h1 class="ml-4 text-xl font-bold">
      <a [routerLink]="routes.home"
        class="text-white hover:text-blue-300 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-blue-300 rounded">
        Q-LMS
      </a>
    </h1>
    }
  </div>

  <nav class="flex-1 mt-6">
    <ul class="space-y-2 px-2">
      @if (user) {
      @switch (getUserType()) {
      @case ('student') {
      @for (item of student_no; track trackByTitle($index, item)) {
      <li>
        <ng-container *ngTemplateOutlet="menuItem; context: { item: item }"></ng-container>
      </li>
      }
      }
      @case ('instructor') {
      @for (item of instructor; track trackByTitle($index, item)) {
      <li>
        <ng-container *ngTemplateOutlet="menuItem; context: { item: item }"></ng-container>
      </li>
      }
      }
      @case ('school_admin') {
      @for (item of school_admin; track trackByTitle($index, item)) {
      <li>
        <ng-container *ngTemplateOutlet="menuItem; context: { item: item }"></ng-container>
      </li>
      }
      }
      @case ('department_admin') {
      @for (item of department_admin; track trackByTitle($index, item)) {
      <li>
        <ng-container *ngTemplateOutlet="menuItem; context: { item: item }"></ng-container>
      </li>
      }
      }
      @case ('super_admin') {
      @for (item of superAdminTabs(); track trackByTitle($index, item)) {
      <li>
        <ng-container *ngTemplateOutlet="menuItem; context: { item: item }"></ng-container>
      </li>
      }
      }
      }
      }
    </ul>
  </nav>

  <div class="mt-auto mb-6 px-4">
    <button (click)="logout()" (keyup.enter)="logout()"
      class="w-full flex items-center justify-center py-2 px-4 rounded-lg text-white bg-red-600 hover:bg-red-700 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-red-300">
      <i class="fas fa-sign-out-alt" [ngClass]="{'mr-2': isSidebarExpanded}"></i>
      @if (isSidebarExpanded) {
      <span>Logout</span>
      }
    </button>
  </div>
</aside>

<ng-template #menuItem let-item="item">
  @if (item.subItems && item.subItems.length) {
  <div class="relative">
    <!-- Dropdown trigger button -->
    <div (click)="toggleDropdown(item.title)" (keyup.enter)="toggleDropdown(item.title)"
      (keyup.space)="toggleDropdown(item.title)"
      class="flex items-center justify-between p-2 rounded-lg cursor-pointer transition-all duration-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-300"
      [ngClass]="{'bg-gray-700': isOpen[item.title]}" role="button" tabindex="0"
      [attr.aria-expanded]="isOpen[item.title]">
      <span class="flex items-center">
        <i [class]="iconMap[item.title] || 'fas fa-book'" class="w-5 h-5" [ngClass]="{'mr-3': isSidebarExpanded}"></i>
        @if (isSidebarExpanded) {
        <span>{{ item.title }}</span>
        }
      </span>
      @if (isSidebarExpanded) {
      <i [ngClass]="{'fa-chevron-down': !isOpen[item.title], 'fa-chevron-up': isOpen[item.title]}"
        class="fas text-sm transition-transform duration-300"></i>
      }
    </div>
    @if (isOpen[item.title]) {
    <ul class="mt-2 space-y-1 bg-gray-900 rounded-md overflow-hidden"
      [ngClass]="{'absolute left-full top-0 ml-2 w-48': !isSidebarExpanded, 'ml-4': isSidebarExpanded}">
      @for (subItem of item.subItems; track trackByTitle($index, subItem)) {
      <li>
        <a [routerLink]="subItem.route"
          class="flex items-center p-2 text-gray-300 hover:text-white hover:bg-gray-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-300">
          <i [class]="iconMap[subItem.title] || 'fas fa-chevron-right'" class="w-4 h-4 mr-3"></i>
          <span>{{ subItem.title }}</span>
        </a>
      </li>
      }
    </ul>
    }
  </div>
  } @else {
  <a [routerLink]="item.route"
    class="flex items-center p-2 rounded-lg text-gray-300 hover:text-white hover:bg-gray-700 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-blue-300"
    [ngClass]="{'bg-gray-700 text-white': isActive(item.route)}">
    <i [class]="iconMap[item.title] || 'fas fa-book'" class="w-5 h-5" [ngClass]="{'mr-3': isSidebarExpanded}"></i>
    @if (isSidebarExpanded) {
    <span>{{ item.title }}</span>
    }
  </a>
  }
</ng-template>
